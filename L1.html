<!DOCTYPE html>
<html>
<head>
 <script src="https://unpkg.com/jspsych@7.3.4"></script>
 <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
 <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.1.3"></script>
 <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
 <script src="https://cdn.jsdelivr.net/gh/cpozniak/JsPsych/speeded_acceptability_judgment.js"></script>
 <script src="https://unpkg.com/@jspsych/plugin-survey-likert@1.1.3"></script>
 <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
 <script src="https://unpkg.com/@jspsych/plugin-external-html@1.0.0"></script>
 <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
<script src="jatos.js"></script>



</head>
<body>

<script>
var jsPsych = initJsPsych({
  on_trial_start: jatos.addAbortButton,
  on_finish: () => jatos.endStudy(jsPsych.data.get().json())
});

var timeline = [];

// generate a random subject ID that contains 8 alphanumeric characters
var rand_subject_id = jsPsych.randomization.randomID(8);
// add the ID to the data for all trials
jsPsych.data.addProperties({ ID: rand_subject_id });

// Define targetSentences and fillerSentences variables
var targetSentences = {
  timeline_variables: [
   { sentence: 'L\'avocat qui connait l\'enseignant va au_cin&eacute;ma samedi_prochain.', condition: 'sujetrestrictive', item: '1', correct_response: 'j'},
   { sentence: 'Nathalie, que l\'employ&eacute;e cherche, quitte son_poste &agrave;_la_fin_d\'ann&eacute;e.', condition: 'objetappositive', item: '2', correct_response: 'j'},
   { sentence: 'Nicolas, qui aide la_vendeuse, habite en_France pour_le_moment.', condition: 'sujetappositive', item: '3', correct_response: 'j'},
   { sentence: 'La d&eacute;put&eacute;e que la_ministre soutient annonce sa_candidature aux_&eacute;lections.', condition: 'objetrestrictive', item: '4', correct_response: 'j'},

   { sentence: 'L\'officier qui invite le_pr&eacute;sident boit du_th&eacute; tous_les_jours.', condition: 'sujetrestrictive', item: '5', correct_response: 'j'},
   { sentence: 'Alicia, que l\'architecte suit, pr&eacute;sente un_projet &agrave;_la_r&eacute;union.', condition: 'objetappositive', item: '6', correct_response: 'j'},
   { sentence: 'Antonie, qui consulte l\'assistant, d&eacute;jeune au_restaurant tous_les_midis.', condition: 'sujetappositive', item: '7', correct_response: 'j'},
   { sentence: 'La guide que la_secr&eacute;taire contacte part pour_les_&eacute;tats-Unis la_semaine_prochaine.', condition: 'objetrestrictive', item: '8', correct_response: 'j'},

   { sentence: 'Le_coiffeur qui encourage l\'&eacute;crivain chante tous_les_soirs &agrave;_l\'&eacute;glise.', condition: 'sujetrestrictive', item: '9', correct_response: 'j'},
   { sentence: 'No&eacute;mie, que la_coach embrasse, travaille &agrave;_l\'&eacute;tranger depuis_deux_ans.', condition: 'objetappositive', item: '10', correct_response: 'j'},
   { sentence: 'Gabriel, qui copie le_peintre, apprend de_nouvelles_techniques tous_les_jours.', condition: 'sujetappositive', item: '11', correct_response: 'j'},
   { sentence: 'L\'expert que La_maire accompagne passe une_soir&eacute;e avec_ses_amis.', condition: 'objetrestrictive', item: '12', correct_response: 'j'},

   { sentence: 'Le_chasseur qui guide le_paysan habite dans_la_for&ecirc;t pr&egrave;s_d\'une_montagne.', condition: 'sujetrestrictive', item: '13', correct_response: 'j'},
   { sentence: 'Louisa, que la_chercheuse pr&eacute;sente, participe &agrave;_plusieurs_&eacute;tapes du_projet.', condition: 'objetappositive', item: '14', correct_response: 'j'},
   { sentence: 'Alexandre, qui approche le_lecteur, vient &agrave;_la_biblioth&egrave;que tous_les_matins.', condition: 'sujetappositive', item: '15', correct_response: 'j'},
   { sentence: 'La_danseuse que la_chanteuse entra&icirc;ne donne un_spectacle au_cabaret.', condition: 'objetrestrictive', item: '16', correct_response: 'j'},

   { sentence: 'L\'artisan qui complimente le_designer expose ses_&oelig;uvres pour_la_premi&egrave;re_fois.', condition: 'sujetrestrictive', item: '17', correct_response: 'j'},
   { sentence: 'Julianna, que la_psychologue questionne, arrive tr&egrave;s_t&ocirc;t &agrave;_la_salle_d\'&eacute;mission.', condition: 'objetappositive', item: '18', correct_response: 'j'},
   { sentence: 'Valentino, qui critique le_moniteur, marque un_but dans_le_match.', condition: 'sujetappositive', item: '19', correct_response: 'j'},
   { sentence: 'La_musicienne que la_photographe inspire r&eacute;p&egrave;te un_morceau pour_le_concert.', condition: 'objetrestrictive', item: '20', correct_response: 'j'},
  ],
};

var fillerSentences = {
  timeline_variables: [
   { sentence: 'Rapha&euml;l a_l\'habitude de_prendre un_caf&eacute; parce_qu\'il n\'aime_pas le_caf&eacute;.', condition: 'S&eacute;mantiquement', item: '21', correct_response: 'f'},
   { sentence: 'La_circulation est_fluide aujourd\'hui, donc le_gestionnaire va_&ecirc;tre en_retard pour_son_travail.', condition: 'S&eacute;mantiquement', item: '22', correct_response: 'f'},
   { sentence: 'Jean a_regard&eacute; un_film_d\'&eacute;pouvante hier_soir et il_a_ri aux_larmes.', condition: 'S&eacute;mantiquement', item: '23', correct_response: 'f'},
   { sentence: 'Th&eacute;o compte_jouer au_tennis parce_qu\'il fait mauvais_temps aujourd\'hui.', condition: 'S&eacute;mantiquement', item: '24', correct_response: 'f'},
   { sentence: 'Les_oiseaux chantent dans_la_for&ecirc;t, c\'est le_signe du_d&eacute;but de_l\'hiver.', condition: 'S&eacute;mantiquement', item: '25', correct_response: 'f'},

   { sentence: 'Les_joyeusement_enfants jouent dans_le_parc_voisin avec_leurs_amis.', condition: 'Syntaxiquement', item: '26', correct_response: 'f'},
   { sentence: 'M&eacute;line ont_besoin des_vacances pour bien_se_reposer apr&egrave;s_le_travail_lourd.', condition: 'Syntaxiquement', item: '27', correct_response: 'f'},
   { sentence: 'On_devrait une_soir&eacute;e organiser entre_amis chez_moi ce_samedi.', condition: 'Syntaxiquement', item: '28', correct_response: 'f'},
   { sentence: 'Le_m&eacute;canicien le_m&eacute;tro a_pris ce_matin et il_y_avait beaucoup_de_monde.', condition: 'Syntaxiquement', item: '29', correct_response: 'f'},
   { sentence: 'Le_r&eacute;alisateur a_regard&eacute; hier_soir chez_lui apr&egrave;s_son_travail.', condition: 'Syntaxiquement', item: '30', correct_response: 'f'},

   { sentence: 'Les_voisins organisent un_pique-nique dans_le_parc ce_samedi.', condition: 'OK', item: '31', correct_response: 'j'},
   { sentence: 'Ce_projet &agrave;_long_terme demande beaucoup_de_patience et de_pers&eacute;v&eacute;rance.', condition: 'OK', item: '32', correct_response: 'j'},
   { sentence: 'Le_r&eacute;dacteur a_h&acirc;te de_voyager parce_que les_vacances approchent.', condition: 'OK', item: '33', correct_response: 'j'},
   { sentence: 'Antoine a_d&eacute;couvert un_nouvel_album dans_la_boutique_de_disques.', condition: 'OK', item: '34', correct_response: 'j'},
   { sentence: 'Les_&eacute;changes_culturels enrichissent notre_compr&eacute;hension du_monde.', condition: 'OK', item: '35', correct_response: 'j'},
   { sentence: 'Les_amis se_retrouvent dans_le_caf&eacute; pour_discuter de_tout.', condition: 'OK', item: '36', correct_response: 'j'},
   { sentence: 'Philippe a_failli_manquer le_train pour_son_voyage dimanche_dernier.', condition: 'OK', item: '37', correct_response: 'j'},
   { sentence: 'Le_commer&ccedil;ant va &agrave;_la_campagne tous_les_weekends, chez_ses_parents.', condition: 'OK', item: '38', correct_response: 'j'},
   { sentence: 'Il_y_a_eu une_incendie dans_le_magasin, on_a_appel&eacute; les_pompiers.', condition: 'OK', item: '39', correct_response: 'j'},
   { sentence: 'Tout_le_monde dit que le_march&eacute; de_cette_ann&eacute;e va &ecirc;tre_mauvais.', condition: 'OK', item: '40', correct_response: 'j'},
  ],
};

var practicesentences = {
  timeline_variables: [
   { sentence: 'L\'&eacute;ducation est_obligatoire pour_tous sans_exception.', condition: 'OK', item: '101', correct_response: 'j' },
   { sentence: 'Je_ne_compte_pas d\'y_aller, donc je_peux vous_y_emmener.' , condition: 'agrammatical', item: '102', correct_response: 'f' },
  ],
};

// Combine targetSentences and fillerSentences into a single array
var allSentences = targetSentences.timeline_variables.concat(fillerSentences.timeline_variables);

// Fisher-Yates (Knuth) shuffle algorithm
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
};

// Shuffle the allSentences array
shuffleArray(allSentences);

// Shuffle the fillers array
var practicesentencesarray = practicesentences.timeline_variables;
shuffleArray(practicesentencesarray);

// sample function that might be used to check if a subject has given
// consent to participate.
var check_consent = function(elem) {
    if (document.getElementById('consent_checkbox1').checked) {
        return true;
    }
    else {
        alert("Si vous souhaitez participer, vous devez cocher la case \u00e0 c\u00f4t\u00e9 de la d\u00e9claration `J\'accepte de participer \u00e0 cette \u00e9tude`.");
        return false;
    }
    return false;
};

var avantexperience = {
    type: jsPsychExternalHtml,
    url: "https://raw.githubusercontent.com/XinyuGuo1016/Instrutions/main/info1.html",
    cont_btn: "start1",
    check_fn: check_consent
};

var check_consent = function(elem) {
    if (document.getElementById('consent_checkbox2').checked) {
        return true;
    }
    else {
        alert("Si vous souhaitez participer, vous devez cocher la case \u00e0 c\u00f4t\u00e9 de la d\u00e9claration `J\'ai bien compris le consigne.`");
        return false;
    }
    return false;
};

// declare the block.
var consigne = {
    type: jsPsychExternalHtml,
    url: "https://raw.githubusercontent.com/XinyuGuo1016/Instrutions/main/info2.html",
    cont_btn: "start2",
    check_fn: check_consent
};

// Commencement
// 开始
var sep = {
 type: jsPsychHtmlButtonResponse,
 stimulus: `Fin de l\'entra&icirc;nement. L\'exp&eacute;rience va commencer.`,
 choices: [`On commence`]
};

var findexperience = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `L\'exp&eacute;rience est termin&eacute;, il vous reste seulement deux questions sur votre profil.`,
  choices: [`On continue`]
};

// Profil
// 信息收集
var question1 = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: `Pour vous le fran&ccedil;ais est&#58;`,
      name: 'Contextelinguistique', 
      options: ['votre langue maternelle unique.', 'une de vos langues maternelles.', 'une langue que vous avez apprise.'], 
      required: true
    }, 
  ],
};

var question2 = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: `Quel est votre tranche d\'&acirc;ge?`,
      name: 'Tranchedage', 
      options: ['18-30 ans', '31-40 ans', '41-50 ans', '51-60 ans', '61-70 ans','71-80 ans','81-90 ans','91-100 ans'], 
      required: true
    }, 
  ],
};

var question3 = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Est-ce que vous avez une id&eacute;e de ce sur quoi porte cette exp&eacute;rience?'}
  ],
};

// Fin
var fin = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: `Fin de l\'exp&eacute;rience, merci beaucoup pour votre participation!`,
};

// avantpractice
// 热身之前
var avantpractice = {
 type: jsPsychHtmlButtonResponse,
 stimulus: `Commen&ccedil;ons par un petit entra&icirc;nement pour vous familiariser avec l\'exp&eacute;rience.`,
 choices: [`On commence`]
};

// practice
// 热身
var practice = {
timeline: [],
};

practicesentencesarray.forEach((sentence) => {
  practice.timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<p style="font-family: Arial; font-size: 32pt;">+</p>',
    trial_duration: 500,
  });

  practice.timeline.push({
    type: WordByWordPlugin,
    stimulus_duration: 500,
    words: sentence.sentence,
  });

  practice.timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Appuyez sur F pour inacceptable et J pour acceptable',
    choices: ['F', 'J'],
    data: {
      task: 'response',
      item: sentence.item,
      correct_response: sentence.correct_response,
      condition: sentence.condition,
      sentence: sentence.sentence,
    },
    on_finish: function (data) {
      data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
      data.choice = data.response;
    },
    trial_duration: 3000,
    response_ends_trial: true,
  });

  practice.timeline.push({
    type: jsPsychSurveyLikert,
    questions: [
      {
        prompt: `&Agrave; quel point avez-vous confiance en votre r&eacute;ponse?`,
        labels: [
          "Pas du tout confiant",
          "pas trop confiant",
          "Neutre",
          "confiant",
          "Tout &agrave fait confiant",
        ],
        required: true,
      },
    ],
    data: {
      item: sentence.item,
      condition: sentence.condition,
      sentence: sentence.sentence,
      correct_response: sentence.correct_response,
    },
  });
});

// Create a new timeline with the shuffled sentences
var mixedTimeline = {
  timeline: [],
};

// Exp&eacute;rience
// 实验
allSentences.forEach((sentence) => {
  mixedTimeline.timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<p style="font-family: Arial; font-size: 32pt;">+</p>',
    trial_duration: 500,
  });

  mixedTimeline.timeline.push({
    type: WordByWordPlugin,
    stimulus_duration: 500,
    words: sentence.sentence,
  });

  mixedTimeline.timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: 'Appuyez sur F pour inacceptable et J pour acceptable',
    choices: ['F', 'J'],
    data: {
      task: 'response',
      item: sentence.item,
      correct_response: sentence.correct_response,
      condition: sentence.condition,
      sentence: sentence.sentence,
    },
    on_finish: function (data) {
      data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
      data.choice = data.response;
    },
    trial_duration: 3000,
    response_ends_trial: true,
    });

  mixedTimeline.timeline.push({
    type: jsPsychSurveyLikert,
    questions: [
      {
        prompt: `&Agrave; quel point avez-vous confiance en votre r&eacute;ponse?`,
        labels: [
          "Pas du tout confiant",
          "pas trop confiant",
          "Neutre",
          "confiant",
          "Tout &agrave fait confiant",
        ],
        required: true,  
      },
    ],
    data: {
          item: sentence.item,
          condition: sentence.condition,
          sentence: sentence.sentence,
          correct_response: sentence.correct_response,
          },
  });
});

// Timeline
// 时间线
var test_procedure = {
  timeline: [avantexperience, consigne, avantpractice, practice, sep, mixedTimeline, findexperience, question1, question2, question3, fin],
};



jatos.onLoad(() => {
  jsPsych.run(test_procedure);
});
</script>

</body>
</html>
